add.lines = list(c("Player Fixed Effects", "Yes", "Yes", "Yes", "Yes"),
c("Year Fixed Effects", "Yes", "Yes", "Yes", "Yes"),
c("Position Fixed Effects", "Yes", "Yes", "Yes", "Yes")),
report = "vcsp*",
ci = TRUE,
title = "Using Win Shares as the Dependent Variables"),
label = 'regwinshares',
sep = '\n', file = "tables/geewinshares.txt")
summary(gee.ws)
install.packages("broom")
install.packages("broom")
library(broom)
broom::confint_tidy(gee.ws)
confint(gee.ws)
broom::confint_tidy(gee.ws, parm = contract_year, level = 0.95)
broom::confint_tidy(gee.ws, parm = contract_year)
broom::confint_tidy(gee.ws, parm = "contract_year")
summary(gee.ws)
summary.geews <- my.summary.lm(summary(gee.ws),
my.rows=grep("contract_year|min|season|salary_current",
names(coef(gee.ws))))
summary.geews <- my.summary.lm(summary(gee.ws),
my.rows=grep("contract_year|min|season|salary_current"))
summary.geews <- my.summary.lm(summary(gee.ws),
my.rows=grep("contract_year|min|season|salary_current",
names(coef(gee.ws))))
summary(gee.ws)
summary.geeows <- my.summary.lm(summary(gee.ows),
my.rows=grep("contract_year|min|season|salary_current",
names(coef(gee.ows))))
summary.geedws <- my.summary.lm(summary(gee.dws),
my.rows=grep("contract_year|min|season|salary_current",
names(coef(gee.dws))))
summary(gee.ws)
View(gee.ws)
summary.geews <- my.summary.lm(summary(gee.ws),
my.rows=grep("contract_year|min|season|salary_current|Intercept",
names(coef(gee.ws))))
broom::confint_tidy(gee.ws, parm = "min")
broom::confint_tidy(gee.ws, parm = "(Intercept)")
broom::confint_tidy(gee.ws, parm = "contract_year")
broom::confint_tidy(gee.ws, parm = "salary_current")
summary.geeows <- my.summary.lm(summary(gee.ows),
my.rows=grep("contract_year|min|season|salary_current|Intercept",
names(coef(gee.ows))))
broom::confint_tidy(gee.ows, parm = "contract_year")
broom::confint_tidy(gee.ows, parm = "min")
broom::confint_tidy(gee.ows, parm = "salary_current")
broom::confint_tidy(gee.ows, parm = "(Intercept)")
summary.geedws <- my.summary.lm(summary(gee.dws),
my.rows=grep("contract_year|min|season|salary_current|Intercept",
names(coef(gee.dws))))
broom::confint_tidy(gee.dws, parm = "contract_year")
broom::confint_tidy(gee.dws, parm = "min")
broom::confint_tidy(gee.dws, parm = "salary_current")
broom::confint_tidy(gee.dws, parm = "(Intercept)")
gee.dw
gee.dws
predict(gee.usg)
X.controls <- c("height", "weight", "age", "per",
"min", "ts", "x3p_ar", "f_tr", "orb", "drb", "trb",
"ast", "stl", "blk", "tov", "usg",
"obpm", "dbpm", "bpm", "vorp", "dist_miles",
"dist_miles_off", "dist_miles_def", "avg_speed",
"avg_speed_off", "avg_speed_def", "salary_current",
"box_outs", "off_box_outs", "def_box_outs",
"team_reb_on_box_outs", "player_reb_on_box_outs",
"touches", "front_ct_touches", "time_of_poss",
"avg_sec_per_touch", "avg_drib_per_touch",
"pts_per_touch", "elbow_touches",
"post_ups", "paint_touches", "pts_per_elbow_touch",
"pts_per_post_touch", "pts_per_paint_touch")
X <- nba.LASSO %>%
select(all_of(X.controls))
View(X)
Y.outcome <- c("ws")
Z <- c("name", "height", "weight", "season",
"age.x", "pos", "g", "mp", "rk", "salary_current", "team.x", "w.y", "l.y")
Y <- nba.LASSO %>%
select(all_of(Y.outcome))
X <- nba.LASSO %>%
ungroup %>%
select(all_of(X.controls))
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
D.inference <- c("contract_year")
D <- nba.LASSO %>%
ungroup %>%
select(all_of(D.inference))
## -------------------------------------------------------------------------
##
## Double LASSO: OWS
##
## -------------------------------------------------------------------------
## We require X to be the matrix of controls. That would be:
## Height
## Weight
## Age
## PER - player efficiency rating
## min - minutes played
## TS - True shooting percentage
## x3p_ar - 3-point attempt rate
## f_tr - Free throw attempt rate
## orb, drb, trb - rebound percentage
## ast, stl, blk - assist, steal, block
## tov - turnover
## usg - usage percentage
## obpm, dbpm, bpm - box plus/minus
## vorp - value over replacement player
## dist_miles, dist_miles_off, dist_miles_def
## avg_speed, avg_speed_off, avg_speed_def
## salary_current,
## box_outs, off_box_outs, def_box_outs
## team_reb_on_box_outs,
## player_reb_on_box_outs,
## touches
## front_ct_touches,
## time_of_poss,
## avg_sec_per_touch,
## avg_drib_per_touch,
## pts_per_touch,
## elbow_touches,
## post_ups,
## paint_touches,
## pts_per_elbow_touch,
## pts_per_post_touch,
## pts_per_paint_touch
X.controls <- c("height", "weight", "age", "per",
"min", "ts", "x3p_ar", "f_tr", "orb", "drb", "trb",
"ast", "stl", "blk", "tov", "usg",
"obpm", "dbpm", "bpm", "vorp", "dist_miles",
"dist_miles_off", "dist_miles_def", "avg_speed",
"avg_speed_off", "avg_speed_def", "salary_current",
"box_outs", "off_box_outs", "def_box_outs",
"team_reb_on_box_outs", "player_reb_on_box_outs",
"touches", "front_ct_touches", "time_of_poss",
"avg_sec_per_touch", "avg_drib_per_touch",
"pts_per_touch", "elbow_touches",
"post_ups", "paint_touches", "pts_per_elbow_touch",
"pts_per_post_touch", "pts_per_paint_touch")
X <- nba.LASSO %>%
ungroup %>%
select(all_of(X.controls))
## Y is the matrix of outcome.
Y.outcome <- c("ws")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
## Finally D is the matrix of inference variable.
D.inference <- c("contract_year")
D <- nba.LASSO %>%
ungroup %>%
select(all_of(D.inference))
lassoeff <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
## -------------------------------------------------------------------------
##
## Double LASSO: OWS
##
## -------------------------------------------------------------------------
## We require X to be the matrix of controls. That would be:
## Height
## Weight
## Age
## PER - player efficiency rating
## min - minutes played
## TS - True shooting percentage
## x3p_ar - 3-point attempt rate
## f_tr - Free throw attempt rate
## orb, drb, trb - rebound percentage
## ast, stl, blk - assist, steal, block
## tov - turnover
## usg - usage percentage
## obpm, dbpm, bpm - box plus/minus
## vorp - value over replacement player
## dist_miles, dist_miles_off, dist_miles_def
## avg_speed, avg_speed_off, avg_speed_def
## salary_current,
## box_outs, off_box_outs, def_box_outs
## team_reb_on_box_outs,
## player_reb_on_box_outs,
## touches
## front_ct_touches,
## time_of_poss,
## avg_sec_per_touch,
## avg_drib_per_touch,
## pts_per_touch,
## elbow_touches,
## post_ups,
## paint_touches,
## pts_per_elbow_touch,
## pts_per_post_touch,
## pts_per_paint_touch
X.controls <- c("height", "weight", "age", "per",
"min", "ts", "x3p_ar", "f_tr", "orb", "drb", "trb",
"ast", "stl", "blk", "tov", "usg",
"obpm", "dbpm", "bpm", "vorp", "dist_miles",
"dist_miles_off", "dist_miles_def", "avg_speed",
"avg_speed_off", "avg_speed_def", "salary_current",
"box_outs", "off_box_outs", "def_box_outs",
"team_reb_on_box_outs", "player_reb_on_box_outs",
"touches", "front_ct_touches", "time_of_poss",
"avg_sec_per_touch", "avg_drib_per_touch",
"pts_per_touch", "elbow_touches",
"post_ups", "paint_touches", "pts_per_elbow_touch",
"pts_per_post_touch", "pts_per_paint_touch")
X <- nba.LASSO %>%
ungroup %>%
select(all_of(X.controls))
X <- as.matrix(X)
## Y is the matrix of outcome.
Y.outcome <- c("ws")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
## Finally D is the matrix of inference variable.
D.inference <- c("contract_year")
D <- nba.LASSO %>%
ungroup %>%
select(all_of(D.inference))
D <- as.matrix(D)
lassoeff <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lassoeff)
summary(lassoeff)
confint(lassoeff)
plot(lassoeff)
lassoeff.index
lassoeff$selection.index
lasso.ws <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.ws)
summary(lasso.ws)
confint(lasso.ws)
plot(lasso.ws)
print(lasso.ws$no.selected)
print(lasso.ws$alpha)
print(lasso.ws$se)
print(lasso.ws$pval)
print(lasso.ws$coefficients)
print(lasso.ws$selection.index)
print(lasso.ws$selection)
print(lasso.ws$residuals)
Y.outcome <- c("ows")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
lasso.ows <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.ows)
summary(lasso.ows)
confint(lasso.ows)
plot(lasso.ows)
print(lasso.ows$selection.index)
Y.outcome <- c("dws")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
lasso.dws <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.dws)
summary(lasso.dws)
confint(lasso.dws)
plot(lasso.dws)
print(lasso.dws$selection.index)
X.controls <- c("height", "weight", "age", "per",
"min", "ts", "x3p_ar", "f_tr", "orb", "drb", "trb",
"ast", "stl", "blk", "tov", "dist_miles",
"dist_miles_off", "dist_miles_def", "salary_current",
"box_outs", "off_box_outs", "def_box_outs",
"team_reb_on_box_outs", "player_reb_on_box_outs",
"touches", "front_ct_touches", "time_of_poss",
"avg_sec_per_touch", "avg_drib_per_touch",
"pts_per_touch", "elbow_touches",
"post_ups", "paint_touches", "pts_per_elbow_touch",
"pts_per_post_touch", "pts_per_paint_touch")
X <- nba.LASSO %>%
ungroup %>%
select(all_of(X.controls))
X <- as.matrix(X)
Y.outcome <- c("ws")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
## Finally D is the matrix of inference variable.
D.inference <- c("contract_year")
D <- nba.LASSO %>%
ungroup %>%
select(all_of(D.inference))
D <- as.matrix(D)
lasso.ws <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.ws)
summary(lasso.ws)
print(lasso.ws$selection.index)
X.controls <- c("height", "weight", "age",
"min", "f_tr", "orb", "drb", "trb",
"ast", "stl", "blk", "tov", "dist_miles",
"dist_miles_off", "dist_miles_def", "salary_current",
"box_outs", "off_box_outs", "def_box_outs",
"team_reb_on_box_outs", "player_reb_on_box_outs",
"touches", "front_ct_touches", "time_of_poss",
"avg_sec_per_touch", "avg_drib_per_touch",
"pts_per_touch", "elbow_touches",
"post_ups", "paint_touches", "pts_per_elbow_touch",
"pts_per_post_touch", "pts_per_paint_touch")
X <- nba.LASSO %>%
ungroup %>%
select(all_of(X.controls))
X <- as.matrix(X)
## Y is the matrix of outcome.
Y.outcome <- c("ws")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
## Finally D is the matrix of inference variable.
D.inference <- c("contract_year")
D <- nba.LASSO %>%
ungroup %>%
select(all_of(D.inference))
D <- as.matrix(D)
lasso.ws <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.ws)
summary(lasso.ws)
confint(lasso.ws)
plot(lasso.ws)
print(lasso.ws$selection.index)
Y.outcome <- c("ows")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
lasso.ows <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.ows)
summary(lasso.ows)
confint(lasso.ows)
plot(lasso.ows)
print(lasso.ows$selection.index)
Y.outcome <- c("dws")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
lasso.dws <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.dws)
summary(lasso.dws)
confint(lasso.dws)
plot(lasso.dws)
print(lasso.dws$selection.index)
X.controls <- c("height", "weight", "age",
"min", "f_tr", "orb", "drb", "trb",
"ast", "stl", "blk", "tov", "dist_miles",
"dist_miles_off", "dist_miles_def", "salary_current",
"box_outs", "off_box_outs", "def_box_outs",
"team_reb_on_box_outs", "player_reb_on_box_outs",
"touches", "front_ct_touches", "time_of_poss",
"avg_sec_per_touch", "avg_drib_per_touch",
"pts_per_touch", "elbow_touches",
"post_ups", "paint_touches", "pts_per_elbow_touch",
"pts_per_post_touch", "pts_per_paint_touch")
X <- nba.LASSO %>%
ungroup %>%
select(all_of(X.controls))
X <- as.matrix(X)
## Y is the matrix of outcome.
Y.outcome <- c("ws")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
## Finally D is the matrix of inference variable.
D.inference <- c("contract_year")
D <- nba.LASSO %>%
ungroup %>%
select(all_of(D.inference))
D <- as.matrix(D)
lasso.ws <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.ws)
summary(lasso.ws)
confint(lasso.ws)
plot(lasso.ws)
print(lasso.ws$selection.index)
## ----------------
Y.outcome <- c("ows")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
lasso.ows <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.ows)
summary(lasso.ows)
confint(lasso.ows)
plot(lasso.ows)
print(lasso.ows$selection.index)
Y.outcome <- c("dws")
Y <- nba.LASSO %>%
ungroup %>%
select(all_of(Y.outcome))
Y <- as.matrix(Y)
lasso.dws <- rlassoEffect(x = X, y = Y, d = D, method = "double selection",
I3 = NULL,
post = TRUE)
print(lasso.dws)
summary(lasso.dws)
confint(lasso.dws)
plot(lasso.dws)
print(lasso.dws$selection.index)
nbaiv <- read.csv("ivnba.csv")
View(nbaiv)
nba.LASSO <- nba %>%
filter(team != "TOT") %>%
group_by(team, season) %>%
mutate_all(funs(weighted.mean(., min))) %>%
summarize_all(mean)
nba.LASSO <- nba %>%
filter(team != "TOT") %>%
group_by(team, season) %>%
mutate_all(funs(weighted.mean(., min))) %>%
summarize_all(mean) %>%
select_if(~sum(!is.na(.)) > 0)
View(nba.LASSO)
nba.LASSO.iv <- nbaiv %>%
filter(team != "TOT") %>%
group_by(team, season) %>%
mutate_all(funs(weighted.mean(., min))) %>%
summarize_all(mean) %>%
select_if(~sum(!is.na(.)) > 0)
View(nba.LASSO.iv)
nbaiv <- read.csv("ivnba.csv")
nbaiv <- clean_names(nbaiv)
nba.LASSO.iv <- nbaiv %>%
filter(team != "TOT") %>%
group_by(team, season) %>%
mutate_all(funs(weighted.mean(., min))) %>%
summarize_all(mean) %>%
select_if(~sum(!is.na(.)) > 0)
lasso.iv.ws <- rlassoIV(formula = ws ~ height + weight + age +
min + f_tr + orb + drb + trb +
ast + stl + blk +  tov + dist_miles+dist_miles_off+dist_miles_def+salary_current+
box_outs+off_box_outs+def_box_outs+team_reb_on_box_outs+player_reb_on_box_outs+
touches+front_ct_touches+time_of_poss+avg_sec_per_touch+avg_drib_per_touch+
pts_per_touch+elbow_touches+post_ups+paint_touches+pts_per_elbow_touch+
pts_per_post_touch+pts_per_paint_touch + contract_year | height + weight + age +
min + f_tr + orb + drb + trb +
ast + stl + blk +  tov + dist_miles+dist_miles_off+dist_miles_def+salary_current+
box_outs+off_box_outs+def_box_outs+team_reb_on_box_outs+player_reb_on_box_outs+
touches+front_ct_touches+time_of_poss+avg_sec_per_touch+avg_drib_per_touch+
pts_per_touch+elbow_touches+post_ups+paint_touches+pts_per_elbow_touch+
pts_per_post_touch+pts_per_paint_touch + contract_2018,
data = nba.LASSO.iv, select.Z = FALSE, select.X = TRUE)
print(lasso.iv.ws)
summary(lasso.iv.ws)
confint(lasso.iv.ws)
plot(lasso.iv.ws)
lasso.iv.ows <- rlassoIV(formula = ows ~ height + weight + age +
min + f_tr + orb + drb + trb +
ast + stl + blk +  tov + dist_miles+dist_miles_off+dist_miles_def+salary_current+
box_outs+off_box_outs+def_box_outs+team_reb_on_box_outs+player_reb_on_box_outs+
touches+front_ct_touches+time_of_poss+avg_sec_per_touch+avg_drib_per_touch+
pts_per_touch+elbow_touches+post_ups+paint_touches+pts_per_elbow_touch+
pts_per_post_touch+pts_per_paint_touch + contract_year | height + weight + age +
min + f_tr + orb + drb + trb +
ast + stl + blk +  tov + dist_miles+dist_miles_off+dist_miles_def+salary_current+
box_outs+off_box_outs+def_box_outs+team_reb_on_box_outs+player_reb_on_box_outs+
touches+front_ct_touches+time_of_poss+avg_sec_per_touch+avg_drib_per_touch+
pts_per_touch+elbow_touches+post_ups+paint_touches+pts_per_elbow_touch+
pts_per_post_touch+pts_per_paint_touch + contract_2018,
data = nba.LASSO.iv, select.Z = FALSE, select.X = TRUE)
print(lasso.iv.ows)
summary(lasso.iv.ows)
confint(lasso.iv.ows)
lasso.iv.dws <- rlassoIV(formula = dws ~ height + weight + age +
min + f_tr + orb + drb + trb +
ast + stl + blk +  tov + dist_miles+dist_miles_off+dist_miles_def+salary_current+
box_outs+off_box_outs+def_box_outs+team_reb_on_box_outs+player_reb_on_box_outs+
touches+front_ct_touches+time_of_poss+avg_sec_per_touch+avg_drib_per_touch+
pts_per_touch+elbow_touches+post_ups+paint_touches+pts_per_elbow_touch+
pts_per_post_touch+pts_per_paint_touch + contract_year | height + weight + age +
min + f_tr + orb + drb + trb +
ast + stl + blk +  tov + dist_miles+dist_miles_off+dist_miles_def+salary_current+
box_outs+off_box_outs+def_box_outs+team_reb_on_box_outs+player_reb_on_box_outs+
touches+front_ct_touches+time_of_poss+avg_sec_per_touch+avg_drib_per_touch+
pts_per_touch+elbow_touches+post_ups+paint_touches+pts_per_elbow_touch+
pts_per_post_touch+pts_per_paint_touch + contract_2018,
data = nba.LASSO.iv, select.Z = FALSE, select.X = TRUE)
print(lasso.iv.dws)
summary(lasso.iv.dws)
confint(lasso.iv.dws)
lasso.iv.ws$coefficients
lasso.iv.ws$vcov
